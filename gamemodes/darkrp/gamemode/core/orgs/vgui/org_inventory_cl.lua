
local function a(b,c,d)draw.RoundedBox(5,0,0,c,d,ui.col.Background)if b:IsHovered()&&b:IsEnabled()then draw.RoundedBox(5,0,0,c,d,ui.col.Hover)end end;local e={}function e:Init()self.Items={}self.pnlTop=ui.Create('Panel',function(f)f:Dock(TOP)f:SetTall(35)end,self)self.pnlItems=ui.Create('ui_scrollpanel',function(f)f:Dock(FILL)f.NoAutoLayout=true end,self)self.ItemCount=ui.Create('ui_button',self.pnlTop)self.ItemCount:Dock(LEFT)self.ItemCount:SetFont('ui.22')self.ItemCount:SetText('Items')self.ItemCount:SetDisabled(true)self.ItemCount.Paint=a;self.ItemCount:SetCursor('arrow')self.SortOptions=ui.Create('ui_button',self.pnlTop)self.SortOptions:Dock(RIGHT)self.SortOptions:SetWide(30)self.SortOptions:SetTooltip('Sort: '..(cvar.GetValue('pocket_sort')||self.DefaultPocketSort))self.SortOptions:SetText('')self.SortOptions:SetIcon('sup/gui/generic/sort.png')self.SortOptions.Paint=a;self.SortOptions.DoClick=function(b)local g=ui.DermaMenu(b)for h,i in pairs(self.SortFuncs)do local j=g:AddOption(h,function()cvar.SetValue('pocket_sort',h)b:SetTooltip('Sort: '..h)self:SortItems()self:InvalidateLayout(true)end)if h==cvar.GetValue('pocket_sort')then j:SetImage('sup/gui/generic/check-mark.png')j.m_Image:SetSize(j:GetTall(),j:GetTall())end end;g:Open()end;local k=1;for h,i in SortedPairs(rp.pocket.Whitelist)do i.Index=k;k=k+1 end end;function e:SortItems()local l=cvar.GetValue('pocket_sort')local m=self.SortFuncs[l]&&self.SortFuncs[l]||self.SortFuncs[self.DefaultPocketSort]table.sort(self.Items,function(n,o)local p,q=rp.entities.GetByClass(n.EntityClass),rp.entities.GetByClass(o.EntityClass)return m(n,p,o,q)end)end;function e:SetData(r)local s=self.pnlItems.yOffset;self.pnlItems:GetCanvas():Clear()self.Data=r;self.ItemAmount=0;local function t(u,v)local w=rp.pocket.Whitelist[u]if!w then print('Attempting to add blacklisted item '..u)return end;local x=ui.Create('rp_modelbutton')self.pnlItems:AddItem(x)x:SetModel(w.Model)x:SetTopText(w.Name)local y=cvar.GetValue('pocket_custom_colors')[u]||w.Color;if y then x:SetColor(setmetatable(y,_R.Color))end;x:SetBottomText('x'..string.Comma(v))x:SetMouseInputEnabled(true)x.DoRightClick=function(b)end;x.OnDepressed=function()self.Clicking=true end;x.OnReleased=function()self.Clicking=nil end;x._Paint=x._Paint||x.Paint;x.Paint=function(b,c,d)draw.Blur(b)x._Paint(b,c,d)end;x.EntityClass=u;x.Count=v;x.Index=w.Index;self.Items[#self.Items+1]=x;self.ItemAmount=self.ItemAmount+v;return x end;for u,v in SortedPairs(self.Data)do if v<=0 then continue end;local x=t(u,v)if x then if self.OrgMenu.Perms.InvWithdraw&&LocalPlayer():GetPocketCapacity()>self:GetParent():GetParent():GetParent().playerPocket.ItemAmount then x:SetHoverText('Withdraw')x.DoClick=function(b)self:ItemWithdraw(b,u)end else x:SetMouseInputEnabled(false)end end end;self:SortItems()self.ItemCount:SetText(self.ItemAmount..'/'..self.OrgMenu.InventorySpace..' Items')self:InvalidateLayout(true)self.pnlItems:SetOffset(s)end;function e:ItemWithdraw(x,u)net.Start'rp.OrgInvWithdraw'net.WriteString(u)net.SendToServer()end;local z,A,B=175,100,5;function e:PerformLayout(c,d)local c=self.pnlItems:GetCanvas():GetWide()table.Filter(self.Items,function(i)return IsValid(i)end)local C=math.floor(c/(z+5))local D=math.ceil(#self.Items/C)local E=0;c=c-5-C*5;local F=c/C;self.ItemCount:SizeToContentsX()self.ItemCount:SetWide(self.ItemCount:GetWide()+10)local G=self:GetWide()-self.ItemCount:GetWide()-self.SortOptions:GetWide()-5;self.ItemCount:DockMargin(G/2,0,0,5)self.SortOptions:DockMargin(0,0,G/2,5)local H=5;local v,I=0,0;for h,i in ipairs(self.Items)do i:SetSize(F,A)i:SetPos(H+v*(F+5),E+I*(A+5))v=v+1;if v==C then v=0;I=I+1 end end end;function e:Think()end;function e:SetOrgMenu(J)self.OrgMenu=J end;function e:Update()self:SetData(self.OrgMenu.Inventory)end;vgui.Register('org_inventory',e,'rp_pocket_base')