

local function a(b,c,d)draw.RoundedBox(5,0,0,c,d,ui.col.Background)if b:IsHovered()&&b:IsEnabled()then draw.RoundedBox(5,0,0,c,d,ui.col.Hover)end end;local e={}function e:Init()self.Items={}self.pnlTop=ui.Create('Panel',function(f)f:Dock(TOP)f:SetTall(35)end,self)self.pnlItems=ui.Create('ui_scrollpanel',function(f)f:Dock(FILL)f.NoAutoLayout=true end,self)self.ItemCount=ui.Create('ui_button',self.pnlTop)self.ItemCount:Dock(LEFT)self.ItemCount:SetFont('ui.22')self.ItemCount:SetText('Items')self.ItemCount:SetDisabled(true)self.ItemCount.Paint=a;self.ItemCount:SetCursor('arrow')self.SortOptions=ui.Create('ui_button',self.pnlTop)self.SortOptions:Dock(RIGHT)self.SortOptions:SetWide(30)self.SortOptions:SetTooltip('Sort: '..(cvar.GetValue('pocket_sort')||self.DefaultPocketSort))self.SortOptions:SetText('')self.SortOptions:SetIcon('sup/gui/generic/sort.png')self.SortOptions.Paint=a;self.SortOptions.DoClick=function(b)local g=ui.DermaMenu(b)for h,i in pairs(self.SortFuncs)do local j=g:AddOption(h,function()cvar.SetValue('pocket_sort',h)b:SetTooltip('Sort: '..h)self:SortItems()self:InvalidateLayout(true)end)if h==cvar.GetValue('pocket_sort')then j:SetImage('sup/gui/generic/check-mark.png')j.m_Image:SetSize(j:GetTall(),j:GetTall())end end;g:Open()end;local k=1;for h,i in SortedPairs(rp.pocket.Whitelist)do i.Index=k;k=k+1 end end;function e:SortItems()local l=cvar.GetValue('pocket_sort')local m=self.SortFuncs[l]&&self.SortFuncs[l]||self.SortFuncs[self.DefaultPocketSort]table.sort(self.Items,function(n,o)local p,q=rp.entities.GetByClass(n.EntityClass),rp.entities.GetByClass(o.EntityClass)return m(n,p,o,q)end)end;local r=Material('sup/gui/generic/locked.png','smooth')function e:SetData(s)local t=self.pnlItems.yOffset;self.pnlItems:GetCanvas():Clear()self.Data=s;self.ItemAmount=0;local function u(v,w)local x=rp.pocket.Whitelist[v]if!x then print('Attempting to add blacklisted item '..v)return end;local y=ui.Create('rp_modelbutton')self.pnlItems:AddItem(y)y:SetModel(x.Model)y:SetTopText(x.Name)local z=cvar.GetValue('pocket_custom_colors')[v]||x.Color;if z then y:SetColor(setmetatable(z,_R.Color))end;y:SetBottomText('x'..string.Comma(w))y:SetMouseInputEnabled(true)y.DoRightClick=function(b)end;y.OnDepressed=function()self.Clicking=true end;y.OnReleased=function()self.Clicking=nil end;y._Paint=y._Paint||y.Paint;y.Paint=function(b,c,d)draw.Blur(b)y._Paint(b,c,d)if self:IsEntityLocked(v)then surface.SetDrawColor(255,255,255)surface.SetMaterial(r)surface.DrawTexturedRect(5,(d-32)*0.5,32,32)end end;y.EntityClass=v;y.Count=w;y.Index=x.Index;self.Items[#self.Items+1]=y;self.ItemAmount=self.ItemAmount+w;return y end;for v,w in SortedPairs(self.Data)do if w<=0 then continue end;local y=u(v,w)if y then y:SetHoverText(self:IsEntityLocked(v)&&'Locked!'||'Deposit')y.DoClick=function(b)self:ItemDeposit(b,v)end end end;self:SortItems()self.ItemCount:SetText(self.ItemAmount..'/'..LocalPlayer():GetPocketCapacity()..' Items')self:InvalidateLayout(true)self.pnlItems:SetOffset(t)end;function e:ItemDeposit(y,v)if self.Anim||self:IsEntityLocked(v)then return end;net.Start'rp.OrgInvDeposit'net.WriteString(v)net.SendToServer()end;local A,B,C=175,100,5;function e:PerformLayout(c,d)local c=self.pnlItems:GetCanvas():GetWide()table.Filter(self.Items,function(i)return IsValid(i)end)local D=math.floor(c/(A+5))local E=math.ceil(#self.Items/D)local F=0;c=c-5-D*5;local G=c/D;self.ItemCount:SizeToContentsX()self.ItemCount:SetWide(self.ItemCount:GetWide()+10)local H=self:GetWide()-self.ItemCount:GetWide()-self.SortOptions:GetWide()-5;self.ItemCount:DockMargin(H/2,0,0,5)self.SortOptions:DockMargin(0,0,H/2,5)local I=5;local w,J=0,0;for h,i in ipairs(self.Items)do i:SetSize(G,B)i:SetPos(I+w*(G+5),F+J*(B+5))w=w+1;if w==D then w=0;J=J+1 end end end;function e:Think()end;function e:EnableDeposit(K)self.CanDeposit=K;for h,i in ipairs(self.pnlItems:GetCanvas():GetChildren())do i:SetMouseInputEnabled(K)end end;vgui.Register('org_pocket',e,'rp_pocket_base')